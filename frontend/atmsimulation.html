<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATM Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
    .dashboard-container { max-width: 1200px; margin: 0 auto; padding: 20px; min-height: 100vh; }
    .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 20px; padding: 25px 30px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); }
    .welcome-section h1 { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 5px; }
    .welcome-section p { color: #666; font-size: 16px; }
    .logout-btn { background: linear-gradient(135deg, #ff6b6b, #ffa726); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
    .logout-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3); }
    .balance-card { background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 24px; padding: 40px; color: white; margin-bottom: 30px; position: relative; overflow: hidden; box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3); }
    .balance-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); animation: float 6s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 50% { transform: translate(-20px, -20px) rotate(180deg); } }
    .balance-content { position: relative; z-index: 1; }
    .balance-label { font-size: 16px; opacity: 0.9; margin-bottom: 10px; }
    .balance-amount { font-size: 48px; font-weight: 700; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); }
    .card-info { display: flex; justify-content: space-between; align-items: center; font-size: 14px; opacity: 0.9; }
    .actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
    .action-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); transition: all 0.3s ease; }
    .action-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
    .action-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .action-icon { width: 50px; height: 50px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .deposit-icon { background: linear-gradient(135deg, #2ecc71, #27ae60); }
    .withdraw-icon { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    .history-icon { background: linear-gradient(135deg, #3498db, #2980b9); }
    .action-title { font-size: 20px; font-weight: 600; color: #333; }
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #555; }
    .amount-input { width: 100%; padding: 15px; border: 2px solid #e1e8ed; border-radius: 12px; font-size: 16px; font-weight: 500; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.8); }
    .amount-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 20px rgba(102, 126, 234, 0.2); background: white; }
    .action-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .deposit-btn { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; }
    .withdraw-btn { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
    .action-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2); }
    .action-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .history-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); }
    .history-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .history-title { font-size: 22px; font-weight: 600; color: #333; }
    .transaction-list { max-height: 400px; overflow-y: auto; }
    .transaction-item { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-radius: 12px; margin-bottom: 12px; background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(0, 0, 0, 0.05); transition: all 0.3s ease; }
    .transaction-item:hover { background: rgba(255, 255, 255, 0.8); transform: translateX(5px); }
    .transaction-info { display: flex; align-items: center; gap: 15px; }
    .transaction-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: white; }
    .deposit { background: linear-gradient(135deg, #2ecc71, #27ae60); }
    .withdraw { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    .transaction-details h4 { margin: 0; font-size: 16px; font-weight: 600; color: #333; }
    .transaction-details p { margin: 0; font-size: 14px; color: #666; margin-top: 2px; }
    .transaction-amount { font-size: 18px; font-weight: 600; }
    .amount-positive { color: #27ae60; }
    .amount-negative { color: #e74c3c; }
    .empty-history { text-align: center; padding: 40px; color: #666; }
    .empty-history-icon { font-size: 48px; margin-bottom: 15px; opacity: 0.5; }
    .message { padding: 15px 20px; border-radius: 12px; margin: 15px 0; font-weight: 500; display: flex; align-items: center; gap: 10px; }
    .message.success { background: rgba(46, 204, 113, 0.1); color: #27ae60; border: 1px solid rgba(46, 204, 113, 0.3); }
    .message.error { background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid rgba(231, 76, 60, 0.3); }
    .loading { animation: pulse 1s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    @media (max-width: 768px) {
      .dashboard-container { padding: 15px; }
      .header { flex-direction: column; gap: 20px; text-align: center; }
      .balance-card { padding: 30px 25px; }
      .balance-amount { font-size: 36px; }
      .actions-grid { grid-template-columns: 1fr; }
      .action-card { padding: 25px 20px; }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="header">
      <div class="welcome-section">
        <h1 id="welcomeMessage">Welcome back!</h1>
        <p>Manage your account with ease</p>
      </div>
      <button class="logout-btn" onclick="logout()">
        <span>üö™</span>Logout
      </button>
    </div>
    <div class="balance-card">
      <div class="balance-content">
        <div class="balance-label">Current Balance</div>
        <div class="balance-amount" id="currentBalance">$0.00</div>
        <div class="card-info">
          <span id="cardNumber">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
          <span>ATM Card</span>
        </div>
      </div>
    </div>
    <div class="actions-grid">
      <div class="action-card">
        <div class="action-header">
          <div class="action-icon deposit-icon">üì•</div>
          <div class="action-title">Deposit Money</div>
        </div>
        <form id="depositForm">
          <div class="input-group">
            <label for="depositAmount">Amount to Deposit</label>
            <input type="number" id="depositAmount" class="amount-input" placeholder="0.00" min="0.01" step="0.01" required>
          </div>
          <button type="submit" class="action-btn deposit-btn">
            <span>üí∞</span>Deposit
          </button>
        </form>
        <div id="depositMessage"></div>
      </div>
      <div class="action-card">
        <div class="action-header">
          <div class="action-icon withdraw-icon">üì§</div>
          <div class="action-title">Withdraw Money</div>
        </div>
        <form id="withdrawForm">
          <div class="input-group">
            <label for="withdrawAmount">Amount to Withdraw</label>
            <input type="number" id="withdrawAmount" class="amount-input" placeholder="0.00" min="0.01" step="0.01" required>
          </div>
          <button type="submit" class="action-btn withdraw-btn">
            <span>üí∏</span>Withdraw
          </button>
        </form>
        <div id="withdrawMessage"></div>
      </div>
    </div>
    <div class="history-card">
      <div class="history-header">
        <div class="action-icon history-icon">üìú</div>
        <div class="history-title">Recent Transactions</div>
      </div>
      <div id="transactionList" class="transaction-list">
        <div class="empty-history">
          <div class="empty-history-icon">üìä</div>
          <p>No transactions yet. Start by making a deposit or withdrawal!</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api';
    let currentUser = null;

    async function initDashboard() {
      const userData = localStorage.getItem('atmUser');
      
      if (!userData) {
        alert('‚ùå Please login first!');
        window.location.href = 'login_signup.html';
        return;
      }

      currentUser = JSON.parse(userData);
      
      document.getElementById('welcomeMessage').textContent = `Welcome back, ${currentUser.name}!`;
      const lastFour = currentUser.cardNumber.slice(-4);
      document.getElementById('cardNumber').textContent = `‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ${lastFour}`;
      updateBalance();
      updateTransactionHistory();
    }

    function updateBalance() {
      document.getElementById('currentBalance').textContent = `$${currentUser.balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function showMessage(elementId, message, type = 'success') {
      const messageElement = document.getElementById(elementId);
      messageElement.innerHTML = `<div class="message ${type}">${message}</div>`;
      setTimeout(() => { messageElement.innerHTML = ''; }, 5000);
    }

    function updateTransactionHistory() {
      const transactionList = document.getElementById('transactionList');
      
      if (!currentUser.transactions || currentUser.transactions.length === 0) {
        transactionList.innerHTML = `
          <div class="empty-history">
            <div class="empty-history-icon">üìä</div>
            <p>No transactions yet. Start by making a deposit or withdrawal!</p>
          </div>`;
        return;
      }

      const transactionsHTML = currentUser.transactions.map(transaction => {
        const date = new Date(transaction.date).toLocaleString();
        return `
          <div class="transaction-item">
            <div class="transaction-info">
              <div class="transaction-icon ${transaction.type}">
                ${transaction.type === 'deposit' ? 'üì•' : 'üì§'}
              </div>
              <div class="transaction-details">
                <h4>${transaction.type === 'deposit' ? 'Money Deposited' : 'Money Withdrawn'}</h4>
                <p>${date}</p>
              </div>
            </div>
            <div class="transaction-amount ${transaction.type === 'deposit' ? 'amount-positive' : 'amount-negative'}">
              ${transaction.type === 'deposit' ? '+' : '-'}$${transaction.amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
            </div>
          </div>`;
      }).join('');

      transactionList.innerHTML = transactionsHTML;
    }

    document.getElementById('depositForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const amount = parseFloat(document.getElementById('depositAmount').value);
      
      if (!amount || amount <= 0) {
        showMessage('depositMessage', '‚ùå Please enter a valid amount', 'error');
        return;
      }

      const submitBtn = this.querySelector('.action-btn');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span>‚è≥</span> Processing...';
      submitBtn.disabled = true;
      submitBtn.classList.add('loading');

      try {
        const response = await fetch(`${API_URL}/deposit`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: currentUser.id,
            amount: amount
          })
        });

        const data = await response.json();

        if (data.success) {
          currentUser.balance = data.balance;
          if (!currentUser.transactions) currentUser.transactions = [];
          currentUser.transactions.unshift(data.transaction);
          localStorage.setItem('atmUser', JSON.stringify(currentUser));
          
          updateBalance();
          updateTransactionHistory();
          showMessage('depositMessage', data.message, 'success');
          this.reset();
        } else {
          showMessage('depositMessage', data.message, 'error');
        }
      } catch (error) {
        console.error('Deposit error:', error);
        showMessage('depositMessage', '‚ùå Connection error. Is the server running?', 'error');
      }

      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
      submitBtn.classList.remove('loading');
    });

    document.getElementById('withdrawForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const amount = parseFloat(document.getElementById('withdrawAmount').value);
      
      if (!amount || amount <= 0) {
        showMessage('withdrawMessage', '‚ùå Please enter a valid amount', 'error');
        return;
      }

      if (amount > currentUser.balance) {
        showMessage('withdrawMessage', '‚ùå Insufficient funds', 'error');
        return;
      }

      const submitBtn = this.querySelector('.action-btn');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span>‚è≥</span> Processing...';
      submitBtn.disabled = true;
      submitBtn.classList.add('loading');

      try {
        const response = await fetch(`${API_URL}/withdraw`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: currentUser.id,
            amount: amount
          })
        });

        const data = await response.json();

        if (data.success) {
          currentUser.balance = data.balance;
          if (!currentUser.transactions) currentUser.transactions = [];
          currentUser.transactions.unshift(data.transaction);
          localStorage.setItem('atmUser', JSON.stringify(currentUser));
          
          updateBalance();
          updateTransactionHistory();
          showMessage('withdrawMessage', data.message, 'success');
          this.reset();
        } else {
          showMessage('withdrawMessage', data.message, 'error');
        }
      } catch (error) {
        console.error('Withdrawal error:', error);
        showMessage('withdrawMessage', '‚ùå Connection error. Is the server running?', 'error');
      }

      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
      submitBtn.classList.remove('loading');
    });

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('atmUser');
        window.location.href = 'login_signup.html';
      }
    }

    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>